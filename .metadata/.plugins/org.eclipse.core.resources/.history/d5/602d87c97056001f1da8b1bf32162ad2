package com.wipro.bookingms.service.impl;

import java.time.LocalDateTime;

import org.springframework.stereotype.Service;
import org.springframework.util.ObjectUtils;

import com.wipro.bookingms.entity.Booking;
import com.wipro.bookingms.exception.ResourceNotFoundException;
import com.wipro.bookingms.model.BookingResponse;
import com.wipro.bookingms.repository.BookingRepository;
import com.wipro.bookingms.service.BookingService;

import jakarta.transaction.Transactional;

@Service
public class BookingServiceImpl implements BookingService{

	private final BookingRepository bookingRepository;
	
	public BookingServiceImpl(BookingRepository bookingRepository) {
		this.bookingRepository = bookingRepository;
	}
	
	@Override
	@Transactional
	public BookingResponse createBooking(Booking booking) {
		booking.setBookingTime(LocalDateTime.now());
        booking.setStatus("INITIATED");
		Booking savedBooking = bookingRepository.save(booking);
		if(!ObjectUtils.isEmpty(savedBooking)) {
			BookingResponse bookingResponse = new BookingResponse();
			bookingResponse.setMessage("Booking Initiated");
			bookingResponse.setStatus(true);
		}
	}

	@Override
	@Transactional
	public Booking updateBookingStatus(Long bookingId, String status) {
		Booking booking = bookingRepository.findById(bookingId)
                .orElseThrow(() -> new ResourceNotFoundException("Booking not found"));
        booking.setStatus(status);
        return bookingRepository.save(booking);
	}

}
